
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Monte Carlo experiment &#8212; smartpy latest documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/my_pygments_light.css" />
    <link rel="stylesheet" type="text/css" href="../_static/my_pygments_dark.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="canonical" href="https://thibhlln.github.io/smartpy/tutorial/montecarlo_experiment.html" />
    <link rel="shortcut icon" href="../_static/smartpy-favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../api_reference.html" />
    <link rel="prev" title="Single experiment" href="single_experiment.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="None">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    <img src="../_static/smartpy-logo-light.svg" class="logo__image only-light" alt="Logo image">
    <img src="../_static/smartpy-logo-dark.svg" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
    <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        latest  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables tutorial/montecarlo_experiment and {'json_url': 'https://thibhlln.github.io/smartpy/_static/switcher.json', 'version_match': 'latest'}.
-->

<script type="text/javascript">
// Check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "tutorial/montecarlo_experiment.html",
          tryUrl = event.target.getAttribute("href");
    let otherDocsHomepage = tryUrl.replace(currentFilePath, "");
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
}

// Populate the version switcher from the JSON config file
(function () {
    $.getJSON("https://thibhlln.github.io/smartpy/_static/switcher.json", function(data, textStatus, jqXHR) {
        const currentFilePath = "tutorial/montecarlo_experiment.html";
        let btn = document.getElementById("version_switcher_button");
        // Set empty strings by default so that these attributes exist and can be used in CSS selectors
        btn.dataset["activeVersionName"] = "";
        btn.dataset["activeVersion"] = "";
        // create links to the corresponding page in the other docs versions
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // create the node
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.textContent = `${entry.name}`;
            node.setAttribute("href", `${entry.url}${currentFilePath}`);
            // on click, AJAX calls will check if the linked page exists before
            // trying to redirect, and if not, will redirect to the homepage
            // for that version of the docs.
            node.onclick = checkPageExistsAndRedirect;
            // Add dataset values for the version and name in case people want
            // to apply CSS styling based on this information.
            node.dataset["versionName"] = entry.name;
            node.dataset["version"] = entry.version;

            $("#version_switcher_menu").append(node);
            // replace dropdown button text with the preferred display name of
            // this version, rather than using sphinx's latest variable.
            // also highlight the dropdown entry for the currently-viewed
            // version's entry
            if (entry.version == "latest") {
                node.classList.add("active");
                btn.innerText = btn.dataset["activeVersionName"] = entry.name;
                btn.dataset["activeVersion"] = entry.version;
            }
        });
    });
})();
</script>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../installation.html">
  Installation
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../tutorial.html">
  Tutorial
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api_reference.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../model_description.html">
  Model Description
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../citation.html">
  Citation
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../support.html">
  Support
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../changelog.html">
  Change Log
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../licence.html">
  Licence
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/thibhlln/smartpy" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="single_experiment.html">
   Single experiment
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Monte Carlo experiment
  </a>
 </li>
</ul>

  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sampling">
   Sampling
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setting-up">
     Setting up
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#adjusting-the-parameter-space">
       Adjusting the parameter space
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#defining-the-initial-conditions">
       Defining the initial conditions
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simulating">
     Simulating
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#simulating-in-serial">
       Simulating in serial
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#simulating-in-parallel">
       Simulating in parallel
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#outputs">
       Outputs
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conditioning">
   Conditioning
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Setting up
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id4">
       Defining the initial conditions
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     Simulating
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id6">
       Outputs
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  <div class="section" id="monte-carlo-experiment">
<h1>Monte Carlo experiment<a class="headerlink" href="#monte-carlo-experiment" title="Permalink to this headline"><span class="fa fa-link"></a></h1>
<p>The Monte Carlo experiment presented here consists of two steps: first the
<a class="reference internal" href="#sampling"><span class="std std-ref">sampling</span></a> in the SMART model parameter space, then the
<a class="reference internal" href="#conditioning"><span class="std std-ref">conditioning</span></a> of the sample to select those parameter
sets deemed as satisfactorily reproducing the observed river discharge.</p>
<p>In <code class="xref py py-obj docutils literal notranslate"><span class="pre">smartpy</span></code>, the sampling generates at random a number of parameter sets
that are used to run the SMART model on a given simulation period (the
“calibration” period). The performance of the SMART model structure with
each parameter set is assessed using one or more objective functions.
These objective function values (and optionally the corresponding
streamflow simulations) correspond to the sampling output.</p>
<p>Then, in <code class="xref py py-obj docutils literal notranslate"><span class="pre">smartpy</span></code>, the conditioning selects a subset of parameter sets
from the sampling based on their objective functions values. This subset
of parameter sets is then used to run the SMART model on another given
simulation period (the “evaluation” period, necessarily independent from
the sampling period). The performance of the SMART model with this subset
of parameter sets is then assessed again using one or more objective
functions (not necessarily the same ones as for the conditioning). These
objective function values (and optionally the corresponding streamflow
simulations) correspond to the conditioning output.</p>
<div class="section" id="sampling">
<span id="id1"></span><h2>Sampling<a class="headerlink" href="#sampling" title="Permalink to this headline"><span class="fa fa-link"></a></h2>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">smartpy</span></code> only offers a Latin Hypercube approach (<a class="reference external" href="https:doi.org/10.1080/00401706.2000.10485979">McKay et al., 2000</a>) for sampling the SMART
model parameter space.</p>
<div class="section" id="setting-up">
<h3>Setting up<a class="headerlink" href="#setting-up" title="Permalink to this headline"><span class="fa fa-link"></a></h3>
<p>The configuration of the sampling is done as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">smartpy</span> <span class="kn">import</span> <span class="n">montecarlo</span>

<span class="n">lhs</span> <span class="o">=</span> <span class="n">montecarlo</span><span class="o">.</span><span class="n">LHS</span><span class="p">(</span>
    <span class="n">catchment</span><span class="o">=</span><span class="s1">&#39;ExampleDaily&#39;</span><span class="p">,</span>
    <span class="n">root_f</span><span class="o">=</span><span class="s1">&#39;examples/&#39;</span><span class="p">,</span>
    <span class="n">in_format</span><span class="o">=</span><span class="s1">&#39;csv,</span>
    <span class="n">out_format</span><span class="o">=</span><span class="s1">&#39;csv,</span>
    <span class="n">sample_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">parallel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">save_sim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">settings_filename</span><span class="o">=</span><span class="s1">&#39;ExampleDaily.sttngs&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../api/classes/smartpy.montecarlo.LHS.html#smartpy.montecarlo.LHS" title="smartpy.montecarlo.LHS"><code class="xref py py-obj docutils literal notranslate"><span class="pre">smartpy.montecarlo.LHS</span></code></a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The configuration of the SMART model itself, unlike for the single
experiment, is done through a settings file. An example of such a
settings file is available as a template in the <em>examples/</em> directory.</p>
</div>
<div class="section" id="adjusting-the-parameter-space">
<h4>Adjusting the parameter space<a class="headerlink" href="#adjusting-the-parameter-space" title="Permalink to this headline"><span class="fa fa-link"></a></h4>
<p>The default model parameter ranges used to define the boundaries of the
Latin hypercube are accessible as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ranges</span><span class="p">)</span>
<span class="go">{&#39;T&#39;: (0.9, 1.1), &#39;C&#39;: (0.0, 1.0), &#39;H&#39;: (0.0, 0.3), &#39;D&#39;: (0.0, 1.0), &#39;S&#39;: (0.0, 0.013), &#39;Z&#39;: (15.0, 150.0), &#39;SK&#39;: (1.0, 240.0), &#39;FK&#39;: (48.0, 1440.0), &#39;GK&#39;: (1200.0, 4800.0), &#39;RK&#39;: (1.0, 96.0)}</span>
</pre></div>
</div>
<p>And they can be adjusted by assigning a new dictionary to this attribute:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lhs</span><span class="o">.</span><span class="n">parameter</span><span class="o">.</span><span class="n">ranges</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
    <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
    <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span>
    <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
    <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.013</span><span class="p">),</span>
    <span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">15.0</span><span class="p">,</span> <span class="mf">150.0</span><span class="p">),</span>
    <span class="s1">&#39;SK&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">240.0</span><span class="p">),</span>
    <span class="s1">&#39;FK&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">48.0</span><span class="p">,</span> <span class="mf">1440.0</span><span class="p">),</span>
    <span class="s1">&#39;GK&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1200.0</span><span class="p">,</span> <span class="mf">4800.0</span><span class="p">),</span>
    <span class="s1">&#39;RK&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">96.0</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="defining-the-initial-conditions">
<h4>Defining the initial conditions<a class="headerlink" href="#defining-the-initial-conditions" title="Permalink to this headline"><span class="fa fa-link"></a></h4>
<p>Like in the single experiment example, the “educated guess” approach can be
used as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lhs</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">extra</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;aar&#39;</span><span class="p">:</span> <span class="mi">1200</span><span class="p">,</span>
    <span class="s1">&#39;r-o_ratio&#39;</span><span class="p">:</span> <span class="mf">0.45</span><span class="p">,</span>
    <span class="s1">&#39;r-o_split&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Also, a warm up period can be chosen in the settings file where the model
is configured.</p>
</div>
</div>
<div class="section" id="simulating">
<h3>Simulating<a class="headerlink" href="#simulating" title="Permalink to this headline"><span class="fa fa-link"></a></h3>
<div class="section" id="simulating-in-serial">
<h4>Simulating in serial<a class="headerlink" href="#simulating-in-serial" title="Permalink to this headline"><span class="fa fa-link"></a></h4>
<p>Running the sampling in the parameter space sequentially (i.e. simulating
with one parameter set at a time using one process) can be done as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lhs</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">compression</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../api/methods/smartpy.montecarlo.LHS.run.html#smartpy.montecarlo.LHS.run" title="smartpy.montecarlo.LHS.run"><code class="xref py py-obj docutils literal notranslate"><span class="pre">smartpy.montecarlo.LHS.run</span></code></a></p>
</div>
</div>
<div class="section" id="simulating-in-parallel">
<h4>Simulating in parallel<a class="headerlink" href="#simulating-in-parallel" title="Permalink to this headline"><span class="fa fa-link"></a></h4>
<p>To start the sampling in parallel (i.e. simulating with multiple parameter
sets at a time using multiple processes, the parameter <em>parallel</em> must be
set as <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.11)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a> in the set up step above, and all the steps presented above
(including the <code class="xref py py-obj docutils literal notranslate"><span class="pre">lhs.run(...)</span></code>) must be saved in a Python script, say
<em>lhs_sampling.py</em>. Then, this script must be executed via a <code class="xref py py-obj docutils literal notranslate"><span class="pre">mpirun</span></code>
command as follows (e.g. using 4 processors to initialise 4 processes):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun -np <span class="m">4</span> python lhs_sampling.py
</pre></div>
</div>
</div>
<div class="section" id="outputs">
<h4>Outputs<a class="headerlink" href="#outputs" title="Permalink to this headline"><span class="fa fa-link"></a></h4>
<p>The sampling performed above will have produced an output file
<em>{root_f}/out/{catchment}.SMART.lhs</em> (if <code class="xref py py-obj docutils literal notranslate"><span class="pre">'csv'</span></code> was chosen as the output
format or <em>{root_f}/out/{catchment}.SMART.lhs.nc</em> (if <code class="xref py py-obj docutils literal notranslate"><span class="pre">'netcdf'</span></code> was
chosen as the output format).</p>
</div>
</div>
</div>
<div class="section" id="conditioning">
<span id="id2"></span><h2>Conditioning<a class="headerlink" href="#conditioning" title="Permalink to this headline"><span class="fa fa-link"></a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>A sampling output file is required to perform the conditioning step.</p>
</div>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">smartpy</span></code> offers three conditioning approaches which differ in the way
the parameter sets are elicited as satisfactory:</p>
<ul class="simple">
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">GLUE</span></code> is based on the selection of one or more objective functions
and the a priori definition of conditions (i.e. thresholds) to achieve
with the model simulation on each objective function to deem the
parameter set as “behavioural”;</p></li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Best</span></code> is based on the selection of one target objective function
and the a priori choice of the number of “best” performing parameter
sets to retain;</p></li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Total</span></code> is not a conditioning approach per se, as it retains all
parameter sets for the simulation on the “evaluation” period. This is
provided as a convenient way to offer to the user the opportunity
to perform their own conditioning approach a posteriori using the
streamflow simulations on the “calibration” and the “evaluation” periods
obtained from the sampling and conditioning steps, respectively.</p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../api/classes/smartpy.montecarlo.GLUE.html#smartpy.montecarlo.GLUE" title="smartpy.montecarlo.GLUE"><code class="xref py py-obj docutils literal notranslate"><span class="pre">smartpy.montecarlo.GLUE</span></code></a>, <a class="reference internal" href="../api/classes/smartpy.montecarlo.Best.html#smartpy.montecarlo.Best" title="smartpy.montecarlo.Best"><code class="xref py py-obj docutils literal notranslate"><span class="pre">smartpy.montecarlo.Best</span></code></a>,
<a class="reference internal" href="../api/classes/smartpy.montecarlo.Total.html#smartpy.montecarlo.Total" title="smartpy.montecarlo.Total"><code class="xref py py-obj docutils literal notranslate"><span class="pre">smartpy.montecarlo.Total</span></code></a></p>
</div>
<p>The remainder of this tutorial is based on the <code class="xref py py-obj docutils literal notranslate"><span class="pre">Best</span></code> approach.</p>
<div class="section" id="id3">
<h3>Setting up<a class="headerlink" href="#id3" title="Permalink to this headline"><span class="fa fa-link"></a></h3>
<p>The configuration of the conditioning is done as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">smartpy</span> <span class="kn">import</span> <span class="n">montecarlo</span>

<span class="n">montecarlo</span><span class="o">.</span><span class="n">Best</span><span class="p">(</span>
    <span class="n">catchment</span><span class="o">=</span><span class="s1">&#39;ExampleDaily&#39;</span><span class="p">,</span>
    <span class="n">root_f</span><span class="o">=</span><span class="s1">&#39;examples/&#39;</span><span class="p">,</span>
    <span class="n">in_format</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span>
    <span class="n">out_format</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;KGE,</span>
    <span class="n">nb_best</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
    <span class="n">parallel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">save_sim</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<p>For example, here the two best performing parameter sets amongst the
ten sets sampled are selected based on their Kling-Gupta Efficiency (KGE)
values.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <em>catchment</em> and <em>root_f</em> must be the same between the sampling
and the conditioning steps. In addition, the <em>out_format</em> of the
sampling step must be the sme as the <em>in_format</em> of the conditioning
step.</p>
</div>
<div class="section" id="id4">
<h4>Defining the initial conditions<a class="headerlink" href="#id4" title="Permalink to this headline"><span class="fa fa-link"></a></h4>
<p>The initial conditions can be defined the same way they are in the
sampling step above.</p>
</div>
</div>
<div class="section" id="id5">
<h3>Simulating<a class="headerlink" href="#id5" title="Permalink to this headline"><span class="fa fa-link"></a></h3>
<p>The simulations can be performed the same way they are in the sampling
step above.</p>
<div class="section" id="id6">
<h4>Outputs<a class="headerlink" href="#id6" title="Permalink to this headline"><span class="fa fa-link"></a></h4>
<p>The conditioning performed above will have produced an output file
<em>{root_f}/out/{catchment}.SMART.best</em> (if <code class="xref py py-obj docutils literal notranslate"><span class="pre">'csv'</span></code> was chosen as the output
format or <em>{root_f}/out/{catchment}.SMART.best.nc</em> (if <code class="xref py py-obj docutils literal notranslate"><span class="pre">'netcdf'</span></code> was
chosen as the output format).</p>
</div>
</div>
</div>
</div>


              </article>
              

              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2018-2023, Thibault Hallouin.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>